version: "3.8"

services:
  trainer:
    image: dice-ocr
    build:
      context: ..
      dockerfile: docker/Dockerfile
    deploy:
      mode: replicated
      replicas: 4  # Liczba równoległych kontenerów
    environment:
      - STUDY_NAME=dice_optimization
      - DB_PATH=sqlite:///optuna.db
    volumes:
      - ../src:/app
      - ./data:/app/data
      - ./optuna.db:/app/optuna.db
    restart: unless-stopped
